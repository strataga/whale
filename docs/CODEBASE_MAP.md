---
last_mapped: 2026-02-06T19:32:15Z
total_files: 6
total_tokens: 2789
---

# Codebase Map

> Auto-generated by Cartographer. Last mapped: 2026-02-06T19:32:15Z

## System Overview

Whale is in the **pre-code planning phase** — no application code exists yet. All files are documentation establishing the product vision, requirements, and conventions.

### Proposed Architecture

```mermaid
graph TB
    subgraph Client
        Web["Next.js App (App Router)"]
    end
    subgraph API["Backend API"]
        Server[API Server]
        Auth[Local Auth]
        AI[AI Engine]
    end
    subgraph Data
        DB[(SQLite or Postgres)]
    end
    subgraph External
        Bot1[OpenClaw Bot - Local]
        Bot2[OpenClaw Bot - VPS]
    end

    Web --> Server
    Server --> Auth
    Server --> AI
    Server --> DB
    Server -- "Signed API / Pairing Tokens" --> Bot1
    Server -- "Signed API / Pairing Tokens" --> Bot2
```

## Directory Structure

```
whale/
├── AGENTS.md           # Working agreements for AI agents and developers
├── CLAUDE.md           # Guidance for Claude Code sessions
├── README.md           # Project introduction and vision
├── firebase-debug.log  # Firebase CLI exploration artifact (not committed to plan)
└── docs/
    ├── plan.md         # Lightweight planning doc with MVP scope
    └── PRD.md          # Authoritative product requirements document
```

## File Guide

| File | Purpose | Tokens |
|------|---------|--------|
| `README.md` | Project introduction, vision, core user flow, principles | 229 |
| `AGENTS.md` | Working agreements, repo conventions, milestone overview | 150 |
| `CLAUDE.md` | Claude Code guidance: architecture, data model, conventions | 456 |
| `docs/PRD.md` | Full PRD: functional specs, data model, security, milestones | 1,240 |
| `docs/plan.md` | Lighter planning doc with MVP scope and open questions | 301 |
| `firebase-debug.log` | Firebase CLI debug output from exploratory session | 413 |

## Document Relationships

```mermaid
graph LR
    README["README.md<br/>(Vision)"] --> Plan["docs/plan.md<br/>(Lightweight Plan)"]
    Plan --> PRD["docs/PRD.md<br/>(Full Spec)"]
    PRD --> CLAUDE["CLAUDE.md<br/>(Dev Guidance)"]
    PRD --> AGENTS["AGENTS.md<br/>(Conventions)"]
```

- **README.md** is the entry point; references `docs/plan.md` for details
- **docs/plan.md** is a lighter-weight planning doc that predates the full PRD; mentions Convex as a DB option (not in PRD)
- **docs/PRD.md** is the authoritative spec — all other docs reference or summarize it
- **CLAUDE.md** synthesizes PRD into actionable guidance for Claude Code
- **AGENTS.md** establishes conventions that apply across all contributors

## Data Model

```mermaid
erDiagram
    Workspace ||--o{ User : has
    Workspace ||--o{ Project : contains
    Workspace ||--o{ Bot : connects
    Project ||--o{ Milestone : has
    Project ||--o{ Task : contains
    Milestone ||--o{ Task : groups
    User ||--o{ Task : assigned
    Bot ||--o{ BotTask : executes
    Task ||--o{ BotTask : delegated_via
    User ||--o{ AuditLog : generates

    Workspace {
        id string
        name string
        timezone string
    }
    User {
        id string
        email string
        role enum "Admin/Member/Viewer"
    }
    Project {
        id string
        workspace_id string
        name string
        description string
        status string
    }
    Milestone {
        id string
        project_id string
        name string
        due_date date
    }
    Task {
        id string
        project_id string
        milestone_id string "optional"
        title string
        description string
        status string
        priority string
        assignee_id string
        due_date date
        tags list
    }
    Bot {
        id string
        workspace_id string
        name string
        host string
        status string
        capabilities list
    }
    BotTask {
        id string
        bot_id string
        task_id string
        status string
        output_summary string
        artifact_links list
    }
    AuditLog {
        id string
        user_id string
        action string
        timestamp datetime
        metadata json
    }
```

## Core User Flows

### Project Creation

```mermaid
sequenceDiagram
    participant U as User
    participant W as Web UI
    participant API as Backend API
    participant AI as AI Engine
    participant DB as Database

    U->>W: Describe goal (natural language)
    W->>API: Submit intake
    API->>AI: Parse intent
    AI-->>API: Structured plan (scope, milestones, tasks, risks)
    API->>DB: Store draft plan
    API-->>W: Present plan for review
    U->>W: Approve / edit plan
    W->>API: Finalize plan
    API->>DB: Save approved plan
```

### Bot Pairing & Task Delegation

```mermaid
sequenceDiagram
    participant Admin as Workspace Admin
    participant W as Whale API
    participant Bot as OpenClaw Bot

    Admin->>W: Generate pairing token
    W-->>Admin: One-time token
    Admin->>Bot: Run pairing command with token
    Bot->>W: Register (name, host, capabilities)
    W-->>Bot: Confirmed, device-scoped token issued

    Note over W, Bot: Later...

    W->>Bot: Assign task (signed request)
    Bot-->>W: Result + artifacts
    W->>W: Update task, store output, log to AuditLog
```

## Unresolved Decisions

| Decision | Options | Source |
|----------|---------|--------|
| Database | SQLite vs Postgres | PRD.md §12 |
| Backend framework | Convex (plan.md) vs standard API (PRD.md) | plan.md vs PRD.md |
| Firebase? | Debug log suggests exploration, not documented | firebase-debug.log |
| UI surface | Web app, desktop, or both | plan.md |
| Data location | Local-first vs hosted | plan.md |
| Auth strategy | Optional / no login vs required | plan.md |
| Bot protocol | Specific OpenClaw wire protocol TBD | PRD.md §12 |

## MVP Milestones

| Milestone | Scope | Key Deliverables |
|-----------|-------|------------------|
| **M1** | Core Planner | Workspace + project intake, tasks + milestones, daily plan generator, basic UI |
| **M2** | Bot Integration | Pairing flow, task assignment to bots, result collection |
| **M3** | Security | Encryption at rest, audit logs |
| **M4** | Reporting | Daily summaries, activity logs |

## Conventions

- **Docs**: All documentation in `/docs`
- **Commits**: Small, focused, with clear messages
- **APIs**: Typed with explicit schemas
- **Security**: Encrypted secrets, device-scoped tokens, least-privilege, audit logging
- **Change principle**: Every change must improve onboarding clarity or planning velocity
